{"ast":null,"code":"import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"fallback\", \"src\", \"imgRef\"],\n    _excluded2 = [\"prefixCls\", \"src\", \"alt\", \"fallback\", \"movable\", \"onClose\", \"visible\", \"icons\", \"rootClassName\", \"closeIcon\", \"getContainer\", \"current\", \"count\", \"countRender\", \"scaleStep\", \"minScale\", \"maxScale\", \"transitionName\", \"maskTransitionName\", \"imageRender\", \"imgCommonProps\", \"toolbarRender\", \"onTransform\", \"onChange\"];\nimport classnames from 'classnames';\nimport Dialog from 'rc-dialog';\nimport addEventListener from \"rc-util/es/Dom/addEventListener\";\nimport KeyCode from \"rc-util/es/KeyCode\";\nimport { warning } from \"rc-util/es/warning\";\nimport React, { useContext, useEffect, useRef, useState } from 'react';\nimport { PreviewGroupContext } from \"./context\";\nimport getFixScaleEleTransPosition from \"./getFixScaleEleTransPosition\";\nimport useImageTransform from \"./hooks/useImageTransform\";\nimport useStatus from \"./hooks/useStatus\";\nimport Operations from \"./Operations\";\nimport { BASE_SCALE_RATIO, WHEEL_MAX_SCALE_RATIO } from \"./previewConfig\";\n\nvar PreviewImage = function PreviewImage(_ref) {\n  var fallback = _ref.fallback,\n      src = _ref.src,\n      imgRef = _ref.imgRef,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  var _useStatus = useStatus({\n    src: src,\n    fallback: fallback\n  }),\n      _useStatus2 = _slicedToArray(_useStatus, 2),\n      getImgRef = _useStatus2[0],\n      srcAndOnload = _useStatus2[1];\n\n  return /*#__PURE__*/React.createElement(\"img\", _extends({\n    ref: function ref(_ref2) {\n      imgRef.current = _ref2;\n      getImgRef(_ref2);\n    }\n  }, props, srcAndOnload));\n};\n\nvar Preview = function Preview(props) {\n  var prefixCls = props.prefixCls,\n      src = props.src,\n      alt = props.alt,\n      fallback = props.fallback,\n      _props$movable = props.movable,\n      movable = _props$movable === void 0 ? true : _props$movable,\n      onClose = props.onClose,\n      visible = props.visible,\n      _props$icons = props.icons,\n      icons = _props$icons === void 0 ? {} : _props$icons,\n      rootClassName = props.rootClassName,\n      closeIcon = props.closeIcon,\n      getContainer = props.getContainer,\n      _props$current = props.current,\n      current = _props$current === void 0 ? 0 : _props$current,\n      _props$count = props.count,\n      count = _props$count === void 0 ? 1 : _props$count,\n      countRender = props.countRender,\n      _props$scaleStep = props.scaleStep,\n      scaleStep = _props$scaleStep === void 0 ? 0.5 : _props$scaleStep,\n      _props$minScale = props.minScale,\n      minScale = _props$minScale === void 0 ? 1 : _props$minScale,\n      _props$maxScale = props.maxScale,\n      maxScale = _props$maxScale === void 0 ? 50 : _props$maxScale,\n      _props$transitionName = props.transitionName,\n      transitionName = _props$transitionName === void 0 ? 'zoom' : _props$transitionName,\n      _props$maskTransition = props.maskTransitionName,\n      maskTransitionName = _props$maskTransition === void 0 ? 'fade' : _props$maskTransition,\n      imageRender = props.imageRender,\n      imgCommonProps = props.imgCommonProps,\n      toolbarRender = props.toolbarRender,\n      onTransform = props.onTransform,\n      onChange = props.onChange,\n      restProps = _objectWithoutProperties(props, _excluded2);\n\n  var imgRef = useRef();\n  var downPositionRef = useRef({\n    deltaX: 0,\n    deltaY: 0,\n    transformX: 0,\n    transformY: 0\n  });\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      isMoving = _useState2[0],\n      setMoving = _useState2[1];\n\n  var groupContext = useContext(PreviewGroupContext);\n  var showLeftOrRightSwitches = groupContext && count > 1;\n  var showOperationsProgress = groupContext && count >= 1;\n\n  var _useImageTransform = useImageTransform(imgRef, minScale, maxScale, onTransform),\n      transform = _useImageTransform.transform,\n      resetTransform = _useImageTransform.resetTransform,\n      updateTransform = _useImageTransform.updateTransform,\n      dispatchZoomChange = _useImageTransform.dispatchZoomChange;\n\n  var _useState3 = useState(true),\n      _useState4 = _slicedToArray(_useState3, 2),\n      enableTransition = _useState4[0],\n      setEnableTransition = _useState4[1];\n\n  var rotate = transform.rotate,\n      scale = transform.scale,\n      x = transform.x,\n      y = transform.y;\n  var wrapClassName = classnames(_defineProperty({}, \"\".concat(prefixCls, \"-moving\"), isMoving));\n  useEffect(function () {\n    if (!enableTransition) {\n      setEnableTransition(true);\n    }\n  }, [enableTransition]);\n\n  var onAfterClose = function onAfterClose() {\n    resetTransform('close');\n  };\n\n  var onZoomIn = function onZoomIn() {\n    dispatchZoomChange(BASE_SCALE_RATIO + scaleStep, 'zoomIn');\n  };\n\n  var onZoomOut = function onZoomOut() {\n    dispatchZoomChange(BASE_SCALE_RATIO / (BASE_SCALE_RATIO + scaleStep), 'zoomOut');\n  };\n\n  var onRotateRight = function onRotateRight() {\n    updateTransform({\n      rotate: rotate + 90\n    }, 'rotateRight');\n  };\n\n  var onRotateLeft = function onRotateLeft() {\n    updateTransform({\n      rotate: rotate - 90\n    }, 'rotateLeft');\n  };\n\n  var onFlipX = function onFlipX() {\n    updateTransform({\n      flipX: !transform.flipX\n    }, 'flipX');\n  };\n\n  var onFlipY = function onFlipY() {\n    updateTransform({\n      flipY: !transform.flipY\n    }, 'flipY');\n  };\n\n  var onSwitchLeft = function onSwitchLeft(event) {\n    event === null || event === void 0 ? void 0 : event.preventDefault();\n    event === null || event === void 0 ? void 0 : event.stopPropagation();\n\n    if (current > 0) {\n      setEnableTransition(false);\n      resetTransform('prev');\n      onChange === null || onChange === void 0 ? void 0 : onChange(current - 1, current);\n    }\n  };\n\n  var onSwitchRight = function onSwitchRight(event) {\n    event === null || event === void 0 ? void 0 : event.preventDefault();\n    event === null || event === void 0 ? void 0 : event.stopPropagation();\n\n    if (current < count - 1) {\n      setEnableTransition(false);\n      resetTransform('next');\n      onChange === null || onChange === void 0 ? void 0 : onChange(current + 1, current);\n    }\n  };\n\n  var onMouseUp = function onMouseUp() {\n    if (visible && isMoving) {\n      setMoving(false);\n      /** No need to restore the position when the picture is not moved, So as not to interfere with the click */\n\n      var _downPositionRef$curr = downPositionRef.current,\n          transformX = _downPositionRef$curr.transformX,\n          transformY = _downPositionRef$curr.transformY;\n      var hasChangedPosition = x !== transformX && y !== transformY;\n\n      if (!hasChangedPosition) {\n        return;\n      }\n\n      var width = imgRef.current.offsetWidth * scale;\n      var height = imgRef.current.offsetHeight * scale; // eslint-disable-next-line @typescript-eslint/no-shadow\n\n      var _imgRef$current$getBo = imgRef.current.getBoundingClientRect(),\n          left = _imgRef$current$getBo.left,\n          top = _imgRef$current$getBo.top;\n\n      var isRotate = rotate % 180 !== 0;\n      var fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n\n      if (fixState) {\n        updateTransform(_objectSpread({}, fixState), 'dragRebound');\n      }\n    }\n  };\n\n  var onMouseDown = function onMouseDown(event) {\n    // Only allow main button\n    if (!movable || event.button !== 0) return;\n    event.preventDefault();\n    event.stopPropagation();\n    downPositionRef.current = {\n      deltaX: event.pageX - transform.x,\n      deltaY: event.pageY - transform.y,\n      transformX: transform.x,\n      transformY: transform.y\n    };\n    setMoving(true);\n  };\n\n  var onMouseMove = function onMouseMove(event) {\n    if (visible && isMoving) {\n      updateTransform({\n        x: event.pageX - downPositionRef.current.deltaX,\n        y: event.pageY - downPositionRef.current.deltaY\n      }, 'move');\n    }\n  };\n\n  var onWheel = function onWheel(event) {\n    if (!visible || event.deltaY == 0) return; // Scale ratio depends on the deltaY size\n\n    var scaleRatio = Math.abs(event.deltaY / 100); // Limit the maximum scale ratio\n\n    var mergedScaleRatio = Math.min(scaleRatio, WHEEL_MAX_SCALE_RATIO); // Scale the ratio each time\n\n    var ratio = BASE_SCALE_RATIO + mergedScaleRatio * scaleStep;\n\n    if (event.deltaY > 0) {\n      ratio = BASE_SCALE_RATIO / ratio;\n    }\n\n    dispatchZoomChange(ratio, 'wheel', event.clientX, event.clientY);\n  };\n\n  var onKeyDown = function onKeyDown(event) {\n    if (!visible || !showLeftOrRightSwitches) return;\n\n    if (event.keyCode === KeyCode.LEFT) {\n      onSwitchLeft();\n    } else if (event.keyCode === KeyCode.RIGHT) {\n      onSwitchRight();\n    }\n  };\n\n  var onDoubleClick = function onDoubleClick(event) {\n    if (visible) {\n      if (scale !== 1) {\n        updateTransform({\n          x: 0,\n          y: 0,\n          scale: 1\n        }, 'doubleClick');\n      } else {\n        dispatchZoomChange(BASE_SCALE_RATIO + scaleStep, 'doubleClick', event.clientX, event.clientY);\n      }\n    }\n  };\n\n  useEffect(function () {\n    var onTopMouseUpListener;\n    var onTopMouseMoveListener;\n    var onMouseUpListener;\n    var onMouseMoveListener;\n\n    if (movable) {\n      onMouseUpListener = addEventListener(window, 'mouseup', onMouseUp, false);\n      onMouseMoveListener = addEventListener(window, 'mousemove', onMouseMove, false);\n\n      try {\n        // Resolve if in iframe lost event\n\n        /* istanbul ignore next */\n        if (window.top !== window.self) {\n          onTopMouseUpListener = addEventListener(window.top, 'mouseup', onMouseUp, false);\n          onTopMouseMoveListener = addEventListener(window.top, 'mousemove', onMouseMove, false);\n        }\n      } catch (error) {\n        /* istanbul ignore next */\n        warning(false, \"[rc-image] \".concat(error));\n      }\n    }\n\n    return function () {\n      var _onMouseUpListener, _onMouseMoveListener, _onTopMouseUpListener, _onTopMouseMoveListen;\n\n      (_onMouseUpListener = onMouseUpListener) === null || _onMouseUpListener === void 0 ? void 0 : _onMouseUpListener.remove();\n      (_onMouseMoveListener = onMouseMoveListener) === null || _onMouseMoveListener === void 0 ? void 0 : _onMouseMoveListener.remove();\n      /* istanbul ignore next */\n\n      (_onTopMouseUpListener = onTopMouseUpListener) === null || _onTopMouseUpListener === void 0 ? void 0 : _onTopMouseUpListener.remove();\n      /* istanbul ignore next */\n\n      (_onTopMouseMoveListen = onTopMouseMoveListener) === null || _onTopMouseMoveListen === void 0 ? void 0 : _onTopMouseMoveListen.remove();\n    };\n  }, [visible, isMoving, x, y, rotate, movable]);\n  useEffect(function () {\n    var onKeyDownListener = addEventListener(window, 'keydown', onKeyDown, false);\n    return function () {\n      onKeyDownListener.remove();\n    };\n  }, [visible, showLeftOrRightSwitches, current]);\n  var imgNode = /*#__PURE__*/React.createElement(PreviewImage, _extends({}, imgCommonProps, {\n    width: props.width,\n    height: props.height,\n    imgRef: imgRef,\n    className: \"\".concat(prefixCls, \"-img\"),\n    alt: alt,\n    style: {\n      transform: \"translate3d(\".concat(transform.x, \"px, \").concat(transform.y, \"px, 0) scale3d(\").concat(transform.flipX ? '-' : '').concat(scale, \", \").concat(transform.flipY ? '-' : '').concat(scale, \", 1) rotate(\").concat(rotate, \"deg)\"),\n      transitionDuration: !enableTransition && '0s'\n    },\n    fallback: fallback,\n    src: src,\n    onWheel: onWheel,\n    onMouseDown: onMouseDown,\n    onDoubleClick: onDoubleClick\n  }));\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Dialog, _extends({\n    transitionName: transitionName,\n    maskTransitionName: maskTransitionName,\n    closable: false,\n    keyboard: true,\n    prefixCls: prefixCls,\n    onClose: onClose,\n    visible: visible,\n    wrapClassName: wrapClassName,\n    rootClassName: rootClassName,\n    getContainer: getContainer\n  }, restProps, {\n    afterClose: onAfterClose\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(prefixCls, \"-img-wrapper\")\n  }, imageRender ? imageRender(imgNode, _objectSpread({\n    transform: transform\n  }, groupContext ? {\n    current: current\n  } : {})) : imgNode)), /*#__PURE__*/React.createElement(Operations, {\n    visible: visible,\n    transform: transform,\n    maskTransitionName: maskTransitionName,\n    closeIcon: closeIcon,\n    getContainer: getContainer,\n    prefixCls: prefixCls,\n    rootClassName: rootClassName,\n    icons: icons,\n    countRender: countRender,\n    showSwitch: showLeftOrRightSwitches,\n    showProgress: showOperationsProgress,\n    current: current,\n    count: count,\n    scale: scale,\n    minScale: minScale,\n    maxScale: maxScale,\n    toolbarRender: toolbarRender,\n    onSwitchLeft: onSwitchLeft,\n    onSwitchRight: onSwitchRight,\n    onZoomIn: onZoomIn,\n    onZoomOut: onZoomOut,\n    onRotateRight: onRotateRight,\n    onRotateLeft: onRotateLeft,\n    onFlipX: onFlipX,\n    onFlipY: onFlipY,\n    onClose: onClose\n  }));\n};\n\nexport default Preview;","map":{"version":3,"sources":["/Users/ravisrivastava/Downloads/newbcom/node_modules/rc-image/es/Preview.js"],"names":["_objectSpread","_defineProperty","_extends","_slicedToArray","_objectWithoutProperties","_excluded","_excluded2","classnames","Dialog","addEventListener","KeyCode","warning","React","useContext","useEffect","useRef","useState","PreviewGroupContext","getFixScaleEleTransPosition","useImageTransform","useStatus","Operations","BASE_SCALE_RATIO","WHEEL_MAX_SCALE_RATIO","PreviewImage","_ref","fallback","src","imgRef","props","_useStatus","_useStatus2","getImgRef","srcAndOnload","createElement","ref","_ref2","current","Preview","prefixCls","alt","_props$movable","movable","onClose","visible","_props$icons","icons","rootClassName","closeIcon","getContainer","_props$current","_props$count","count","countRender","_props$scaleStep","scaleStep","_props$minScale","minScale","_props$maxScale","maxScale","_props$transitionName","transitionName","_props$maskTransition","maskTransitionName","imageRender","imgCommonProps","toolbarRender","onTransform","onChange","restProps","downPositionRef","deltaX","deltaY","transformX","transformY","_useState","_useState2","isMoving","setMoving","groupContext","showLeftOrRightSwitches","showOperationsProgress","_useImageTransform","transform","resetTransform","updateTransform","dispatchZoomChange","_useState3","_useState4","enableTransition","setEnableTransition","rotate","scale","x","y","wrapClassName","concat","onAfterClose","onZoomIn","onZoomOut","onRotateRight","onRotateLeft","onFlipX","flipX","onFlipY","flipY","onSwitchLeft","event","preventDefault","stopPropagation","onSwitchRight","onMouseUp","_downPositionRef$curr","hasChangedPosition","width","offsetWidth","height","offsetHeight","_imgRef$current$getBo","getBoundingClientRect","left","top","isRotate","fixState","onMouseDown","button","pageX","pageY","onMouseMove","onWheel","scaleRatio","Math","abs","mergedScaleRatio","min","ratio","clientX","clientY","onKeyDown","keyCode","LEFT","RIGHT","onDoubleClick","onTopMouseUpListener","onTopMouseMoveListener","onMouseUpListener","onMouseMoveListener","window","self","error","_onMouseUpListener","_onMouseMoveListener","_onTopMouseUpListener","_onTopMouseMoveListen","remove","onKeyDownListener","imgNode","className","style","transitionDuration","Fragment","closable","keyboard","afterClose","showSwitch","showProgress"],"mappings":"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","sourcesContent":["import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _excluded = [\"fallback\", \"src\", \"imgRef\"],\n  _excluded2 = [\"prefixCls\", \"src\", \"alt\", \"fallback\", \"movable\", \"onClose\", \"visible\", \"icons\", \"rootClassName\", \"closeIcon\", \"getContainer\", \"current\", \"count\", \"countRender\", \"scaleStep\", \"minScale\", \"maxScale\", \"transitionName\", \"maskTransitionName\", \"imageRender\", \"imgCommonProps\", \"toolbarRender\", \"onTransform\", \"onChange\"];\nimport classnames from 'classnames';\nimport Dialog from 'rc-dialog';\nimport addEventListener from \"rc-util/es/Dom/addEventListener\";\nimport KeyCode from \"rc-util/es/KeyCode\";\nimport { warning } from \"rc-util/es/warning\";\nimport React, { useContext, useEffect, useRef, useState } from 'react';\nimport { PreviewGroupContext } from \"./context\";\nimport getFixScaleEleTransPosition from \"./getFixScaleEleTransPosition\";\nimport useImageTransform from \"./hooks/useImageTransform\";\nimport useStatus from \"./hooks/useStatus\";\nimport Operations from \"./Operations\";\nimport { BASE_SCALE_RATIO, WHEEL_MAX_SCALE_RATIO } from \"./previewConfig\";\nvar PreviewImage = function PreviewImage(_ref) {\n  var fallback = _ref.fallback,\n    src = _ref.src,\n    imgRef = _ref.imgRef,\n    props = _objectWithoutProperties(_ref, _excluded);\n  var _useStatus = useStatus({\n      src: src,\n      fallback: fallback\n    }),\n    _useStatus2 = _slicedToArray(_useStatus, 2),\n    getImgRef = _useStatus2[0],\n    srcAndOnload = _useStatus2[1];\n  return /*#__PURE__*/React.createElement(\"img\", _extends({\n    ref: function ref(_ref2) {\n      imgRef.current = _ref2;\n      getImgRef(_ref2);\n    }\n  }, props, srcAndOnload));\n};\nvar Preview = function Preview(props) {\n  var prefixCls = props.prefixCls,\n    src = props.src,\n    alt = props.alt,\n    fallback = props.fallback,\n    _props$movable = props.movable,\n    movable = _props$movable === void 0 ? true : _props$movable,\n    onClose = props.onClose,\n    visible = props.visible,\n    _props$icons = props.icons,\n    icons = _props$icons === void 0 ? {} : _props$icons,\n    rootClassName = props.rootClassName,\n    closeIcon = props.closeIcon,\n    getContainer = props.getContainer,\n    _props$current = props.current,\n    current = _props$current === void 0 ? 0 : _props$current,\n    _props$count = props.count,\n    count = _props$count === void 0 ? 1 : _props$count,\n    countRender = props.countRender,\n    _props$scaleStep = props.scaleStep,\n    scaleStep = _props$scaleStep === void 0 ? 0.5 : _props$scaleStep,\n    _props$minScale = props.minScale,\n    minScale = _props$minScale === void 0 ? 1 : _props$minScale,\n    _props$maxScale = props.maxScale,\n    maxScale = _props$maxScale === void 0 ? 50 : _props$maxScale,\n    _props$transitionName = props.transitionName,\n    transitionName = _props$transitionName === void 0 ? 'zoom' : _props$transitionName,\n    _props$maskTransition = props.maskTransitionName,\n    maskTransitionName = _props$maskTransition === void 0 ? 'fade' : _props$maskTransition,\n    imageRender = props.imageRender,\n    imgCommonProps = props.imgCommonProps,\n    toolbarRender = props.toolbarRender,\n    onTransform = props.onTransform,\n    onChange = props.onChange,\n    restProps = _objectWithoutProperties(props, _excluded2);\n  var imgRef = useRef();\n  var downPositionRef = useRef({\n    deltaX: 0,\n    deltaY: 0,\n    transformX: 0,\n    transformY: 0\n  });\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isMoving = _useState2[0],\n    setMoving = _useState2[1];\n  var groupContext = useContext(PreviewGroupContext);\n  var showLeftOrRightSwitches = groupContext && count > 1;\n  var showOperationsProgress = groupContext && count >= 1;\n  var _useImageTransform = useImageTransform(imgRef, minScale, maxScale, onTransform),\n    transform = _useImageTransform.transform,\n    resetTransform = _useImageTransform.resetTransform,\n    updateTransform = _useImageTransform.updateTransform,\n    dispatchZoomChange = _useImageTransform.dispatchZoomChange;\n  var _useState3 = useState(true),\n    _useState4 = _slicedToArray(_useState3, 2),\n    enableTransition = _useState4[0],\n    setEnableTransition = _useState4[1];\n  var rotate = transform.rotate,\n    scale = transform.scale,\n    x = transform.x,\n    y = transform.y;\n  var wrapClassName = classnames(_defineProperty({}, \"\".concat(prefixCls, \"-moving\"), isMoving));\n  useEffect(function () {\n    if (!enableTransition) {\n      setEnableTransition(true);\n    }\n  }, [enableTransition]);\n  var onAfterClose = function onAfterClose() {\n    resetTransform('close');\n  };\n  var onZoomIn = function onZoomIn() {\n    dispatchZoomChange(BASE_SCALE_RATIO + scaleStep, 'zoomIn');\n  };\n  var onZoomOut = function onZoomOut() {\n    dispatchZoomChange(BASE_SCALE_RATIO / (BASE_SCALE_RATIO + scaleStep), 'zoomOut');\n  };\n  var onRotateRight = function onRotateRight() {\n    updateTransform({\n      rotate: rotate + 90\n    }, 'rotateRight');\n  };\n  var onRotateLeft = function onRotateLeft() {\n    updateTransform({\n      rotate: rotate - 90\n    }, 'rotateLeft');\n  };\n  var onFlipX = function onFlipX() {\n    updateTransform({\n      flipX: !transform.flipX\n    }, 'flipX');\n  };\n  var onFlipY = function onFlipY() {\n    updateTransform({\n      flipY: !transform.flipY\n    }, 'flipY');\n  };\n  var onSwitchLeft = function onSwitchLeft(event) {\n    event === null || event === void 0 ? void 0 : event.preventDefault();\n    event === null || event === void 0 ? void 0 : event.stopPropagation();\n    if (current > 0) {\n      setEnableTransition(false);\n      resetTransform('prev');\n      onChange === null || onChange === void 0 ? void 0 : onChange(current - 1, current);\n    }\n  };\n  var onSwitchRight = function onSwitchRight(event) {\n    event === null || event === void 0 ? void 0 : event.preventDefault();\n    event === null || event === void 0 ? void 0 : event.stopPropagation();\n    if (current < count - 1) {\n      setEnableTransition(false);\n      resetTransform('next');\n      onChange === null || onChange === void 0 ? void 0 : onChange(current + 1, current);\n    }\n  };\n  var onMouseUp = function onMouseUp() {\n    if (visible && isMoving) {\n      setMoving(false);\n      /** No need to restore the position when the picture is not moved, So as not to interfere with the click */\n      var _downPositionRef$curr = downPositionRef.current,\n        transformX = _downPositionRef$curr.transformX,\n        transformY = _downPositionRef$curr.transformY;\n      var hasChangedPosition = x !== transformX && y !== transformY;\n      if (!hasChangedPosition) {\n        return;\n      }\n      var width = imgRef.current.offsetWidth * scale;\n      var height = imgRef.current.offsetHeight * scale;\n      // eslint-disable-next-line @typescript-eslint/no-shadow\n      var _imgRef$current$getBo = imgRef.current.getBoundingClientRect(),\n        left = _imgRef$current$getBo.left,\n        top = _imgRef$current$getBo.top;\n      var isRotate = rotate % 180 !== 0;\n      var fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n      if (fixState) {\n        updateTransform(_objectSpread({}, fixState), 'dragRebound');\n      }\n    }\n  };\n  var onMouseDown = function onMouseDown(event) {\n    // Only allow main button\n    if (!movable || event.button !== 0) return;\n    event.preventDefault();\n    event.stopPropagation();\n    downPositionRef.current = {\n      deltaX: event.pageX - transform.x,\n      deltaY: event.pageY - transform.y,\n      transformX: transform.x,\n      transformY: transform.y\n    };\n    setMoving(true);\n  };\n  var onMouseMove = function onMouseMove(event) {\n    if (visible && isMoving) {\n      updateTransform({\n        x: event.pageX - downPositionRef.current.deltaX,\n        y: event.pageY - downPositionRef.current.deltaY\n      }, 'move');\n    }\n  };\n  var onWheel = function onWheel(event) {\n    if (!visible || event.deltaY == 0) return;\n    // Scale ratio depends on the deltaY size\n    var scaleRatio = Math.abs(event.deltaY / 100);\n    // Limit the maximum scale ratio\n    var mergedScaleRatio = Math.min(scaleRatio, WHEEL_MAX_SCALE_RATIO);\n    // Scale the ratio each time\n    var ratio = BASE_SCALE_RATIO + mergedScaleRatio * scaleStep;\n    if (event.deltaY > 0) {\n      ratio = BASE_SCALE_RATIO / ratio;\n    }\n    dispatchZoomChange(ratio, 'wheel', event.clientX, event.clientY);\n  };\n  var onKeyDown = function onKeyDown(event) {\n    if (!visible || !showLeftOrRightSwitches) return;\n    if (event.keyCode === KeyCode.LEFT) {\n      onSwitchLeft();\n    } else if (event.keyCode === KeyCode.RIGHT) {\n      onSwitchRight();\n    }\n  };\n  var onDoubleClick = function onDoubleClick(event) {\n    if (visible) {\n      if (scale !== 1) {\n        updateTransform({\n          x: 0,\n          y: 0,\n          scale: 1\n        }, 'doubleClick');\n      } else {\n        dispatchZoomChange(BASE_SCALE_RATIO + scaleStep, 'doubleClick', event.clientX, event.clientY);\n      }\n    }\n  };\n  useEffect(function () {\n    var onTopMouseUpListener;\n    var onTopMouseMoveListener;\n    var onMouseUpListener;\n    var onMouseMoveListener;\n    if (movable) {\n      onMouseUpListener = addEventListener(window, 'mouseup', onMouseUp, false);\n      onMouseMoveListener = addEventListener(window, 'mousemove', onMouseMove, false);\n      try {\n        // Resolve if in iframe lost event\n        /* istanbul ignore next */\n        if (window.top !== window.self) {\n          onTopMouseUpListener = addEventListener(window.top, 'mouseup', onMouseUp, false);\n          onTopMouseMoveListener = addEventListener(window.top, 'mousemove', onMouseMove, false);\n        }\n      } catch (error) {\n        /* istanbul ignore next */\n        warning(false, \"[rc-image] \".concat(error));\n      }\n    }\n    return function () {\n      var _onMouseUpListener, _onMouseMoveListener, _onTopMouseUpListener, _onTopMouseMoveListen;\n      (_onMouseUpListener = onMouseUpListener) === null || _onMouseUpListener === void 0 ? void 0 : _onMouseUpListener.remove();\n      (_onMouseMoveListener = onMouseMoveListener) === null || _onMouseMoveListener === void 0 ? void 0 : _onMouseMoveListener.remove();\n      /* istanbul ignore next */\n      (_onTopMouseUpListener = onTopMouseUpListener) === null || _onTopMouseUpListener === void 0 ? void 0 : _onTopMouseUpListener.remove();\n      /* istanbul ignore next */\n      (_onTopMouseMoveListen = onTopMouseMoveListener) === null || _onTopMouseMoveListen === void 0 ? void 0 : _onTopMouseMoveListen.remove();\n    };\n  }, [visible, isMoving, x, y, rotate, movable]);\n  useEffect(function () {\n    var onKeyDownListener = addEventListener(window, 'keydown', onKeyDown, false);\n    return function () {\n      onKeyDownListener.remove();\n    };\n  }, [visible, showLeftOrRightSwitches, current]);\n  var imgNode = /*#__PURE__*/React.createElement(PreviewImage, _extends({}, imgCommonProps, {\n    width: props.width,\n    height: props.height,\n    imgRef: imgRef,\n    className: \"\".concat(prefixCls, \"-img\"),\n    alt: alt,\n    style: {\n      transform: \"translate3d(\".concat(transform.x, \"px, \").concat(transform.y, \"px, 0) scale3d(\").concat(transform.flipX ? '-' : '').concat(scale, \", \").concat(transform.flipY ? '-' : '').concat(scale, \", 1) rotate(\").concat(rotate, \"deg)\"),\n      transitionDuration: !enableTransition && '0s'\n    },\n    fallback: fallback,\n    src: src,\n    onWheel: onWheel,\n    onMouseDown: onMouseDown,\n    onDoubleClick: onDoubleClick\n  }));\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Dialog, _extends({\n    transitionName: transitionName,\n    maskTransitionName: maskTransitionName,\n    closable: false,\n    keyboard: true,\n    prefixCls: prefixCls,\n    onClose: onClose,\n    visible: visible,\n    wrapClassName: wrapClassName,\n    rootClassName: rootClassName,\n    getContainer: getContainer\n  }, restProps, {\n    afterClose: onAfterClose\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"\".concat(prefixCls, \"-img-wrapper\")\n  }, imageRender ? imageRender(imgNode, _objectSpread({\n    transform: transform\n  }, groupContext ? {\n    current: current\n  } : {})) : imgNode)), /*#__PURE__*/React.createElement(Operations, {\n    visible: visible,\n    transform: transform,\n    maskTransitionName: maskTransitionName,\n    closeIcon: closeIcon,\n    getContainer: getContainer,\n    prefixCls: prefixCls,\n    rootClassName: rootClassName,\n    icons: icons,\n    countRender: countRender,\n    showSwitch: showLeftOrRightSwitches,\n    showProgress: showOperationsProgress,\n    current: current,\n    count: count,\n    scale: scale,\n    minScale: minScale,\n    maxScale: maxScale,\n    toolbarRender: toolbarRender,\n    onSwitchLeft: onSwitchLeft,\n    onSwitchRight: onSwitchRight,\n    onZoomIn: onZoomIn,\n    onZoomOut: onZoomOut,\n    onRotateRight: onRotateRight,\n    onRotateLeft: onRotateLeft,\n    onFlipX: onFlipX,\n    onFlipY: onFlipY,\n    onClose: onClose\n  }));\n};\nexport default Preview;"]},"metadata":{},"sourceType":"module"}